# IO流

-----

[toc]

## Overview

四个相关概念：

- 同步（Synchronous）
- 异步( Asynchronous)
- 阻塞( Blocking )
- 非阻塞( Nonblocking)

![img](https://picx.zhimg.com/80/v2-d6729b9e95e8f20c4e53215327596692_1440w.webp?source=1940ef5c)

```html
让我们看一下《操作系统概念（第九版）》中有关进程间通信的部分是如何解释的:
进程间的通信是通过 send() 和 receive() 两种基本操作完成的. 
具体如何实现这两种基础操作, 存在着不同的设计.
消息的传递有可能是阻塞的或非阻塞的 -- 也被称为同步或异步的:
. 阻塞式发送(blocking send), 发送方进程会被一直阻塞, 直到消息被接受方进程收到.
. 非阻塞式发送(nonblocking send), 发送方进程调用 send() 后, 立即就可以其他操作.
. 阻塞式接收(blocking receive) 接收方调用 receive() 后一直阻塞, 直到消息到达可用.
. 非阻塞式接受(nonblocking receive) 接收方调用 receive() 函数后, 要么得到一个有效的结果, 要么得到一个空值, 即不会被阻塞.

上述不同类型的发送方式和不同类型的接收方式, 可以自由组合.
. 也就是说, 从进程级通信的维度讨论时, 阻塞和同步（非阻塞和异步）就是一对同义词, 且需要针对 '发送方' 和 '接收方' 作区分对待.
```

> 进程间, 消息传递, 发送方 send(), 接收方 receive()



### 先修知识

- 用户空间和内核空间

- 进程切换

- - 系统调用（system call）
  - 中断（interrupt）

- 进程的阻塞

![img](https://picx.zhimg.com/80/v2-5672054f97fd77f78420fed6b442536e_1440w.webp?source=1940ef5c)



### 阻塞/非阻塞, 同步/异步

- **阻塞和非阻塞**描述的是进程的一个操作是否会使得进程转变为“等待/waiting”的状态
- 在进程通信层面， 阻塞/非阻塞， 同步/异步基本是同义词， 但是需要注意区分讨论的对象是发送方还是接收方。
- 阻塞/非阻塞, 是从调用发起者的状态这个角度来描述的. 也就是调用者调用完之后的状态, 比如 waiting/ready/running
- 同步/异步, 是指调用发起后的返回结果的时机和内容的描述. 同步是调用后不返回等执行完成后返回完整结果. 异步是调用后立即返回, 这个返回不是最终结果但有返回, 返回三种结果, 可以是完整的结果, 也可以是不完整的结果(一部分结果),  还可以是一个空值. 而最终完整结果由执行完成后的回调通知回来.









## Concept

### IO

- 输入输出(IO)是指计算机同任何外部设备之间的数据传递.
- 常见的输入输出设备有文件、键盘、打印机、屏幕等.
- 数据可以按记录（或称数据块）的方式传递, 也可以流的方式传递.
- 所谓*记录*, 是指有着内部结构的数据块. 记录内部除了有需要处理的实际数据之外, 还可能包含附加信息, 这些附加信息通常是对本记录数据的描述.
- IO操作的过程中, 任何需要被传递的数据, 在经过IO类库处理前后是不同的. 这样, 我们可以把数据的表示分为两种: 内部表示和外部表示.
  - 数据的内部表示便于程序进行数据处理. 典型的内部表示有: 整型数的二进制表示、浮点数的IEEE表示、字符的ASCII或Unicode编码表示. 
  - 数据的外部表示则根据不同的外部设备的需要, 有具体不同的表现形式. 如果外部数据表示是可读的字符序列, 则称为*文本IO*, 否则为*二进制IO*. *标准IO流*的主要目的是支持文本IO, 不直接支持二进制IO. 
- 虽然IO流是以流的方式进行数据传递, 但这并不表明传递的数据不能有任何结构, 而是指IO流的概念是以流的方式进行输入输出, 所传递数据的内部结构隐藏在对流数据的解释中.

### 流

- 流是一种抽象概念, 它代表了数据的无结构化传递.

### IO流

- *IO流*是一种应用于计算机编程的概念. 按照流的方式进行输入输出, 数据被当成无结构的字节序或字符序列.
- 从流中取得数据的操作称为提取操作, 而向流中添加数据的操作称为插入操作.
- 用来进行输入输出操作的流就称为IO流.
- 在IO流里, 输入输出分为4步: 格式化/解析, 缓冲, 编码转换和传递.

### 步骤

- **格式化/解析：**在内部数据表示（以[字节](https://www.baike.com/wikiid/6760316307995162421?from=wiki_content&prd=innerlink)为单位）与外部数据表示（以字符为单位）之间进行双向转换。例如一个2字节的整数10002，就需要5个字符来表示。

- **缓冲：**用于在格式/解析与传递之间[缓存](https://www.baike.com/wikiid/7793774935793854012?from=wiki_content&prd=innerlink)字符序列。对于输出，较短的字符序列格式化之后并不马上输出，而是保存在缓冲区里，待累积到一定规模之后再传递到外部设备。相反，从外部设备读入的大量数据也是先放在缓冲区，然后逐步取出完成输入。默认时，IO流的输入输出都是经过缓冲的，也可以让IO流工作在无缓冲模式下。

- **编码转换：**是将一种字符表达式转换成另一种字符表达式。如果格式化产生的字符表达式与外部字符表达式不同（输出时），或者外部表达式与IO流能解析的表达式不同（输入时），就必须进行编码转换。如多字节编码与宽[字符编码](https://www.baike.com/wikiid/2402583595867287583?from=wiki_content&prd=innerlink)之间的转换等。多数情况下并不需要进行编码转换。

- **传递：**主要是与外部设备进行通信。输出时，传递负责将经过格式化、缓冲即编码转换后的字符序列发送到外部设备；输入时，则负责将外部设备抽取数据，为其后进行的编码转换、缓冲及解析提供字符序列。

### 操作

 - **I/O操作**, 所有对流的读写操作. 我们都可以称之为IO操作.
 - 当一个流中, 在没有数据read的时候, 或者说在流中已经写满了数据, 再write, 我们的IO操作就会出现一种现象, 就是阻塞现象.

## FAQ



## See Also

https://www.baike.com/wikiid/113646776768397014?prd=mobile&view_id=tfu23chdrk000

https://www.zhihu.com/question/19732473/answer/241673170
